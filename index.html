<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ClipThreat Studio</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  </head>
  <body>
    <header>
      <h1>🧪 ClipThreat Studio</h1>
      <p>クリップボード悪用攻撃の可視化＆体験ツール</p>
    </header>

    <nav class="tab-nav">
      <button class="tab-button active" data-tab="tab-clipboard">
        📋 基本操作
      </button>
      <button class="tab-button" data-tab="tab-watch">🔍 監視モード</button>
      <button class="tab-button" data-tab="tab-sniff">
        🎭 pasteイベントスニッフィング
      </button>
      <button class="tab-button" data-tab="tab-clickfix">
        🚨 ClickFix攻撃
      </button>
      <button class="tab-button" data-tab="tab-autopaste">🧲 自動送信</button>
      <button class="tab-button" data-tab="tab-weirdchar">🧪 文字細工</button>
      <button class="tab-button" data-tab="tab-tips">
        🔒 セキュリティTips
      </button>
    </nav>

    <main>
      <section id="tab-clipboard" class="tab-content active">
        <h2>📋 クリップボード基本操作</h2>
        
        <div class="explanation-box">
          <h3>💡 使い方</h3>
          <ul>
            <li><strong>クリップボードから読み取る</strong>：現在クリップボードに保存されている内容を表示します</li>
            <li><strong>クリップボードに書き込む</strong>：テキストエリアの内容をクリップボードにコピーします</li>
            <li><strong>クリップボードをクリア</strong>：クリップボードを空にします</li>
          </ul>
          <div class="security-note">
            🔒 <strong>セキュリティ注意：</strong>クリップボードの読み取りはユーザーのプライバシーに関わるため、ブラウザーは必ず許可を求めます。
          </div>
        </div>
        
        <div class="tutorial-box">
          <h3>🎯 実際に試してみよう！</h3>
          <div class="tutorial-steps">
            <div class="step" id="step1">
              <span class="step-number">1</span>
              <div class="step-content">
                <p>まず、このテキストを選択してコピーしてみましょう：</p>
                <code class="sample-text" onclick="selectText(this)">クリップボードの実験テキストです🧪</code>
                <small>↑ クリックして選択 → Ctrl+Cでコピー</small>
              </div>
            </div>
            <div class="step" id="step2">
              <span class="step-number">2</span>
              <div class="step-content">
                <p>次に「📋 クリップボードから読み取る」ボタンをクリックして、コピーした内容を確認しましょう</p>
                <div class="permission-notice">
                  <strong>⚠️ 重要：</strong>ブラウザーから「クリップボードへのアクセスを許可しますか？」というダイアログが表示されます。<br>
                  これはセキュリティ上の保護機能です。今回は実験のため<strong>「許可」をクリック</strong>してください。
                </div>
              </div>
            </div>
            <div class="step" id="step3">
              <span class="step-number">3</span>
              <div class="step-content">
                <p>テキストエリアに好きな文字を入力して「✍️ クリップボードに書き込む」をクリック</p>
              </div>
            </div>
            <div class="step" id="step4">
              <span class="step-number">4</span>
              <div class="step-content">
                <p>他のアプリ（メモ帳など）やブラウザーの検索欄にて、Ctrl+Vで貼り付けて確認！</p>
                <button class="step-ok-button" onclick="confirmStep4()" style="display: none; margin-top: 0.5rem;">✅ 確認できました</button>
              </div>
            </div>
          </div>
          <button class="tutorial-reset" onclick="resetTutorial()">🔄 チュートリアルをリセット</button>
        </div>
        
        <textarea
          id="clipboardInput"
          rows="4"
          placeholder="ここにテキストを入力してコピー・ペースト実験..."
        ></textarea>
        <div class="button-row">
          <button onclick="readClipboard()" title="クリップボードの現在の内容を表示">📋 クリップボードから読み取る</button>
          <button onclick="writeClipboard()" title="テキストエリアの内容をクリップボードにコピー">✍️ クリップボードに書き込む</button>
          <button onclick="clearClipboard()" title="クリップボードを空にする">🗑️ クリップボードをクリア</button>
        </div>
        <div class="info-text">
          <small>💡 Ctrl+Enterで書き込みも可能です</small>
        </div>
        <div id="clipboardOutput" class="output-box"></div>
      </section>

      <section id="tab-watch" class="tab-content">
        <h2>🔍 監視モード</h2>
        
        <div class="explanation-box">
          <h3>💡 この機能について</h3>
          <p>クリップボードの内容を定期的に監視し、変化を検出します。</p>
          <p class="warning-text">⚠️ これは悪用されると、ユーザーがコピーした情報を盗み見ることが可能です。</p>
          <div class="permission-notice">
            <strong>🔒 重要な注意事項：</strong><br>
            1. 初回使用時にブラウザーから許可ダイアログが表示されます。<strong>「許可」をクリック</strong>してください。<br>
            2. 監視中はこのタブをアクティブにしておいてください。他のタブやアプリに切り替えると監視が一時停止します。<br>
            3. ローカルファイル(file://)での実行は制限があります。HTTPサーバーでの実行を推奨します。
          </div>
        </div>
        
        <div class="tutorial-box">
          <h3>🎯 実際に試してみよう！</h3>
          <div class="tutorial-steps">
            <div class="step" id="watch-step1">
              <span class="step-number">1</span>
              <div class="step-content">
                <p>まず「📡 自動監視を有効にする」チェックボックスをオンにして監視を開始しましょう</p>
                <div class="permission-notice">
                  <strong>⚠️ 重要：</strong>ブラウザーから「クリップボードへのアクセスを許可しますか？」というダイアログが表示されます。<br>
                  <strong>「許可」をクリック</strong>してください。
                </div>
              </div>
            </div>
            <div class="step" id="watch-step2">
              <span class="step-number">2</span>
              <div class="step-content">
                <p>他のアプリ（メモ帳、ブラウザーなど）で何かテキストをコピーしてみましょう</p>
                <small>例：メモ帳に「テスト文字列」と入力してCtrl+A、Ctrl+C でコピー</small>
              </div>
            </div>
            <div class="step" id="watch-step3">
              <span class="step-number">3</span>
              <div class="step-content">
                <p>ClipThreat Studioの「監視モード」タブに戻ると、下のログにクリップボード変化が記録されているか確認</p>
                <small>💡 タブがアクティブでないと一部ブラウザーでは検出できない場合があります</small>
              </div>
            </div>
            <div class="step" id="watch-step4">
              <span class="step-number">4</span>
              <div class="step-content">
                <p>異なる種類のデータ（URL、メールアドレスなど）もコピーして、タイプ判別機能を確認してみましょう</p>
                <small>例：https://example.com、test@example.com など</small>
              </div>
            </div>
            <div class="step" id="watch-step5">
              <span class="step-number">5</span>
              <div class="step-content">
                <p>監視間隔を変更して、検出の反応速度の違いを体験してみましょう</p>
                <small>推奨：0.5秒にして素早い反応を確認後、5秒にして違いを体感</small>
                <button class="step-ok-button" onclick="confirmWatchStep5()" style="display: none; margin-top: 0.5rem;">✅ 体験できました</button>
              </div>
            </div>
          </div>
          <button class="tutorial-reset" onclick="resetWatchTutorial()">🔄 チュートリアルをリセット</button>
        </div>
        
        <div class="control-panel">
          <label class="watch-toggle">
            <input type="checkbox" id="watchToggle" />
            <span>📡 自動監視を有効にする</span>
          </label>
          
          <div class="interval-selector">
            <label>監視間隔：</label>
            <select id="watchInterval">
              <option value="500">0.5秒</option>
              <option value="1000" selected>1秒</option>
              <option value="2000">2秒</option>
              <option value="5000">5秒</option>
            </select>
          </div>
          
          <button onclick="clearWatchLog()" class="secondary-button">🗑️ ログをクリア</button>
        </div>
        
        <div class="stats-panel">
          <span id="watchStats">📊 監視状態：停止中 | 検出数：0</span>
        </div>
        
        <div id="watchLog" class="output-box watch-log"></div>
        
        <div id="watchCelebrationMessage" class="celebration-message" style="display: none;"></div>
      </section>

      <section id="tab-sniff" class="tab-content">
        <h2>🎭 pasteイベントスニッフィング</h2>
        
        <div class="explanation-box">
          <h3>💡 この機能について</h3>
          <p>pasteイベントスニッフィングは、ユーザーが入力欄に貼り付けを行った瞬間に、その内容を傍受する技術です。</p>
          <p><strong>仕組み：</strong>JavaScriptの<code>paste</code>イベントを使用して、クリップボードデータを読み取ります。</p>
          <div class="security-note">
            🔒 <strong>セキュリティリスク：</strong>悪意あるサイトが、パスワードや機密情報を含む貼り付け内容を盗み取る可能性があります。
          </div>
        </div>



        <div class="tutorial-box">
          <h3>🎯 実際に試してみよう！</h3>
          <div class="tutorial-steps">
            <div class="step" id="sniff-step1">
              <span class="step-number">1</span>
              <div class="step-content">
                <p>まず、テスト用の文字列をコピーしましょう（下の文字列をクリックして選択）</p>
                <code class="sample-text" onclick="selectSniffText(this)">テスト用パスワード: SecretPass123!</code>
                <small>↑ クリックして選択 → Ctrl+Cでコピー</small>
              </div>
            </div>
            <div class="step" id="sniff-step2">
              <span class="step-number">2</span>
              <div class="step-content">
                <p>下の入力欄に貼り付けてください（Ctrl+V）</p>
                <small>💡 貼り付けた瞬間にpasteイベントが発生し、内容が傍受されます</small>
              </div>
            </div>
            <div class="step" id="sniff-step3">
              <span class="step-number">3</span>
              <div class="step-content">
                <p>ログエリアに表示された傍受された内容を確認しましょう</p>
                <small>⚠️ 実際の攻撃では、この情報が攻撃者のサーバーに送信されます</small>
                <button class="step-ok-button" onclick="confirmStep3()" style="display: none; margin-top: 0.5rem;">✅ 理解しました</button>
              </div>
            </div>
            <div class="step" id="sniff-step4">
              <span class="step-number">4</span>
              <div class="step-content">
                <p>別の種類のデータも試してみましょう（クレジットカード風の数字）</p>
                <code class="sample-text" onclick="selectSniffText(this)">4111-1111-1111-1111</code>
                <small>↑ この偽カード番号をコピーして貼り付けてみてください</small>
              </div>
            </div>
            <div class="step" id="sniff-step5">
              <span class="step-number">5</span>
              <div class="step-content">
                <p>実際のWebサイトでは、このような危険性があることを覚えておきましょう</p>
                <small>🛡️ 重要な情報は信頼できるサイトでのみ貼り付けるようにしてください</small>
                <button class="step-ok-button" onclick="confirmStep5()" style="display: none; margin-top: 0.5rem;">✅ 理解しました</button>
              </div>
            </div>
          </div>
          <button class="tutorial-reset" onclick="resetSniffTutorial()">🔄 チュートリアルをリセット</button>
        </div>

        <div class="phishing-form-container">
          <div class="phishing-form">
            <div class="phishing-header">
              <span class="lock-icon">🔒</span>
              <h3>セキュアログインポータル（仮想のフィッシング詐欺ページ）</h3>
              <span class="warning-badge">安全</span>
            </div>
            <div class="phishing-content">
              <label for="sniffInput" class="phishing-label">
                パスワード / 認証コード / 機密情報
              </label>
              <input 
                id="sniffInput" 
                type="password" 
                placeholder="パスワードまたは認証コードを貼り付けてください..." 
                class="phishing-input"
              />
              <small class="phishing-hint">💡 パスワードマネージャーからの貼り付けも可能です</small>
            </div>
            <div class="phishing-footer">
              <span class="fake-secure">🛡️ SSL暗号化通信中</span>
              <span class="fake-verified">✓ 認証済みサイト</span>
            </div>
          </div>
        </div>
        
        <div id="sniffLog" class="output-box"></div>

        <div class="accordion-section">
          <div class="accordion-header" onclick="toggleAttackScenariosAccordion()">
            <h3>⚠️ 実際の攻撃シナリオを確認する</h3>
            <span class="accordion-icon">▼</span>
          </div>
          <div class="accordion-content" id="attackScenariosAccordionContent">
            <div class="explanation-box" style="background: #fff0f0; border-color: #ffc1c1; margin: 0;">
              <ul>
                <li><strong>フィッシングサイト</strong>：偽のログインフォームで、ユーザーがパスワードマネージャーから貼り付けたパスワードを盗取</li>
                <li><strong>偽の支払いページ</strong>：クレジットカード情報や暗号通貨ウォレットアドレスの貼り付けを監視</li>
                <li><strong>偽のファイル共有サイト</strong>：機密文書やプライベートキーの貼り付けを傍受</li>
                <li><strong>ソーシャルエンジニアリング</strong>：「エラーログを貼り付けてください」等の指示で、システム情報を取得</li>
                <li><strong>偽のサポートサイト</strong>：技術サポートを装い、設定ファイルやログファイルの貼り付けを要求</li>
                <li><strong>悪意あるWebアプリ</strong>：便利ツールを装い、ユーザーのデータ入力を監視</li>
              </ul>
              <div class="warning-text" style="margin-top: 1rem;">
                ⚠️ <strong>重要：</strong>この攻撃は、ユーザーが貼り付け操作を行うだけで実行されます。特別な権限や複雑な手順は不要です。
              </div>
            </div>
          </div>
        </div>

        <div class="accordion-section">
          <div class="accordion-header" onclick="toggleSniffAccordion()">
            <h3>🛡️ 対策方法を確認する</h3>
            <span class="accordion-icon">▼</span>
          </div>
          <div class="accordion-content" id="sniffAccordionContent">
            <div class="explanation-box" style="background: #f0fff0; border-color: #90ee90; margin: 0;">
              <ul>
                <li><strong>サイトの信頼性確認</strong>：URLやSSL証明書を必ず確認してから貼り付けを行う</li>
                <li><strong>手動入力の優先</strong>：重要な情報は可能な限り手動で入力する</li>
                <li><strong>ブラウザー拡張機能</strong>：pasteイベントを制限する拡張機能を使用</li>
                <li><strong>開発者ツール確認</strong>：F12キーで開発者ツールを開き、怪しいJavaScriptがないかチェック</li>
                <li><strong>パスワードマネージャーの活用</strong>：自動入力機能により貼り付けを避ける</li>
                <li><strong>コンテンツセキュリティポリシー</strong>：CSPヘッダーでJavaScriptの実行を制限</li>
                <li><strong>ブラウザーの設定</strong>：JavaScriptを部分的に無効化できるブラウザー設定を活用</li>
              </ul>
              <div class="security-note" style="margin-top: 1rem;">
                💡 <strong>開発者向け：</strong>ウェブサイト運営者は、pasteイベントリスナーの使用を最小限に抑え、必要な場合は透明性を保つことが重要です。
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-clickfix" class="tab-content">
        <h2>🚨 ClickFix攻撃シミュレーション</h2>
        
        <div class="explanation-box">
          <h3>💡 ClickFix攻撃とは</h3>
          <p>ClickFix攻撃は、ユーザーを騙して悪意あるコマンドを実行させるソーシャルエンジニアリング攻撃です。</p>
          <p><strong>仕組み：</strong>偽のエラーメッセージや「修復」ボタンで、危険なコマンドをクリップボードにコピーし、実行を促します。</p>
          <div class="security-note">
            🔒 <strong>セキュリティリスク：</strong>一見無害なボタンクリックで、システム全体を乗っ取られる可能性があります。
          </div>
        </div>

        <div class="tutorial-box">
          <h3>🎯 ClickFix攻撃を体験しよう！</h3>
          <div class="tutorial-steps">
            <div class="step" id="clickfix-step1">
              <span class="step-number">1</span>
              <div class="step-content">
                <p>まず、上のClickFix攻撃の説明を読んで仕組みを理解しましょう</p>
                <small>💡 攻撃の概要と危険性を把握してから実際の体験に移ります</small>
                <button class="step-ok-button" onclick="confirmClickFixStep1()" style="margin-top: 0.5rem;">✅ ClickFix攻撃の説明を読んだ</button>
              </div>
            </div>
            <div class="step" id="clickfix-step2">
              <span class="step-number">2</span>
              <div class="step-content">
                <p>下の偽エラーダイアログの仕掛けを観察した後、「🔧 今すぐ修復する（推奨）」ボタンをクリックして攻撃の流れを体験</p>
                <small>💡 本物のエラーメッセージに見える視覚的トリック（点滅、緊急バッジ等）に注目<br>⚠️ 実際にはクリップボードに危険なコマンドがコピーされます</small>
              </div>
            </div>
            <div class="step" id="clickfix-step3">
              <span class="step-number">3</span>
              <div class="step-content">
                <p>下のログエリアで段階的な攻撃の進行を確認しましょう</p>
                <small>🎓 各ステップでの攻撃手法と危険性を学習</small>
                <button class="step-ok-button" onclick="confirmClickFixStep3()" style="display: none; margin-top: 0.5rem;">✅ ステップ4まで読んだ</button>
              </div>
            </div>
            <div class="step" id="clickfix-step4">
              <span class="step-number">4</span>
              <div class="step-content">
                <p>「❌ 後で修復」ボタンもクリックして、キャンセルボタンの罠を確認した後、下の対策方法を読みましょう</p>
                <small>🛡️ 安全な対処法と具体的な対策テクニックを学習</small>
                <button class="step-ok-button" onclick="confirmClickFixStep4()" style="display: none; margin-top: 0.5rem;">✅ 対策方法を読んだ</button>
              </div>
            </div>
          </div>
          <button class="tutorial-reset" onclick="resetClickFixTutorial()">🔄 チュートリアルをリセット</button>
        </div>

        <div class="clickfix-demo">
          <div class="fake-error-dialog">
            <div class="error-header">
              <span class="error-icon">⚠️</span>
              <h3>システムエラー - 緊急修復が必要</h3>
              <span class="urgent-badge">緊急</span>
            </div>
            <div class="error-content">
              <p class="error-message">
                <strong>重要な警告：</strong>システムファイルが破損しています。<br>
                すぐに修復しないと、データが失われる可能性があります。
              </p>
              <div class="error-details">
                エラーコード: 0x80070057<br>
                影響ファイル: system32\kernel.dll<br>
                推定修復時間: 2-3分
              </div>
            </div>
            <div class="error-actions">
              <button class="fix-button" onclick="simulateClickFix()">🔧 今すぐ修復する（推奨）</button>
              <button class="cancel-button" onclick="showCancelWarning()">❌ 後で修復</button>
            </div>
          </div>
        </div>
        
        <div class="button-row">
          <button onclick="resetClickFixDemo()" class="secondary-button">🔄 デモをリセット</button>
        </div>
        
        <div id="clickfixLog" class="output-box"></div>

        <div id="clickfixCelebrationMessage" class="celebration-message" style="display: none;"></div>

        <div class="accordion-section">
          <div class="accordion-header" onclick="toggleClickFixAccordion()">
            <h3>🛡️ ClickFix攻撃への対策方法</h3>
            <span class="accordion-icon">▼</span>
          </div>
          <div class="accordion-content" id="clickfixAccordionContent">
            <div class="explanation-box" style="background: #f0fff0; border-color: #90ee90; margin: 0;">
              <h4>🚨 即座に対処すべきこと</h4>
              <ul>
                <li><strong>ページを閉じる</strong>：「修復」や「キャンセル」ボタンを押さず、ブラウザーを閉じる</li>
                <li><strong>クリップボードを確認</strong>：怪しいコマンドがコピーされていないかチェック</li>
                <li><strong>PowerShell実行の回避</strong>：Win+Rダイアログでは絶対にコマンドを実行しない</li>
              </ul>
              
              <h4>🛡️ 予防対策</h4>
              <ul>
                <li><strong>疑いの習慣</strong>：突然のエラーメッセージやシステム警告は疑う</li>
                <li><strong>公式チャネルの利用</strong>：システム修復は公式サポートやWindows Updateで行う</li>
                <li><strong>URLの確認</strong>：信頼できないサイトでの作業を避ける</li>
                <li><strong>最新ブラウザーの使用</strong>：セキュリティ機能が向上したブラウザーを使用</li>
              </ul>
              
              <h4>⚙️ 技術的対策</h4>
              <ul>
                <li><strong>PowerShell実行ポリシー</strong>：ExecutionPolicyをRestrictedに設定</li>
                <li><strong>クリップボード監視ツール</strong>：怪しいコマンドのコピーを検知するツール使用</li>
                <li><strong>ブラウザー拡張機能</strong>：悪意あるスクリプトをブロックする拡張機能の導入</li>
                <li><strong>ユーザーアカウント制御(UAC)</strong>：管理者権限が必要な操作で確認ダイアログを表示</li>
              </ul>
              
              <div class="security-note" style="margin-top: 1rem;">
                💡 <strong>企業向け対策：</strong>社員教育でClickFix攻撃の認知度を高め、定期的なセキュリティ訓練を実施することが重要です。
              </div>
            </div>
          </div>
        </div>
      </section>

      <section id="tab-autopaste" class="tab-content">
        <h2>🧲 自動ペースト送信デモ</h2>
        <input
          id="autoInput"
          placeholder="ここにペーストすると即送信されます"
        />
        <div id="autoLog" class="output-box"></div>
      </section>

      <section id="tab-weirdchar" class="tab-content">
        <h2>🧪 不正文字列注入デモ</h2>
        <p>
          以下のボタンでゼロ幅スペースや右から左文字を含む文字列をコピーできます。
        </p>
        <button onclick="copyWeirdText()">不正文字列をコピーする</button>
        <div id="weirdOutput" class="output-box"></div>
      </section>

      <section id="tab-tips" class="tab-content">
        <h2>🔒 セキュリティTips</h2>
        <ul class="tips-list">
          <li>クリップボードの読み取りには通常、ユーザー操作が必要です</li>
          <li>HTTPSページでのみ `navigator.clipboard.readText()` は有効です</li>
          <li>「貼り付けるだけ」で情報が漏れるケースがあります</li>
          <li>オートフィルを活用し、コピー＆ペーストは最小限に</li>
        </ul>
      </section>
    </main>

    <footer>
      <div class="footer">
        🔗 GitHubリポジトリはこちら（
        <a href="https://github.com/ipusiron/clipthreat-studio" target="_blank"
          >ipusiron/clipthreat-studio</a
        >
        ）
      </div>
    </footer>
	
    <script src="js/main.js"></script>
    <script src="js/clipboard.js"></script>
    <script src="js/watch.js"></script>
    <script src="js/sniff.js"></script>
    <script src="js/clickfix.js"></script>
    <script src="js/autopaste.js"></script>
    <script src="js/weirdchar.js"></script>
    <script src="js/tips.js"></script>
  </body>
</html>
